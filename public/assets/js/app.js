"use strict";var app=angular.module("myApp",[]);angular.module("myApp").service("leafletService",function(){this.removeAllMarkersFromMap=function(e,t){for(var l=0;l<t.length;l++)e.removeLayer(t[l])},this.renderAllMarkersOnMap=function(e,t){var l=t.map(function(e){return e._latlng});t.splice(0,t.length);for(var r=0;r<l.length;r++)this.createMarker(e,t,l[r])},this.drawPolyline=function(e,t,l){var r=t.map(function(e){return e._latlng}),e=this.removePolyline(e,l);if(r.length>1){e=L.layerGroup();for(var a=0;a<r.length;a++)if(a+1<r.length){var i=L.polyline([r[a],r[a+1]],{color:"red"}).addTo(l),n=L.polylineDecorator(i,{patterns:[{offset:"100%",repeat:0,symbol:new L.Symbol.arrowHead({pixelSize:10,pathOptions:{color:"red"}})}]}).addTo(l);e.addLayer(i),e.addLayer(n)}}return e},this.removePolyline=function(e,t){return e&&e.eachLayer(function(e){t.removeLayer(e)}),null},this.createMarker=function(e,t,l){var r=L.divIcon({className:"leaflet-marker",html:'<div data-index="'+t.length+'">'+(t.length+1)+"</div>"}),a=L.marker([l.lat,l.lng],{icon:r,draggable:!0}).addTo(e);return t.push(a),a}}),angular.module("myApp").directive("leafletMap",["leafletService","$document",function(e,t){return{restrict:"EA",require:"^ngModel",scope:{ngModel:"="},templateUrl:"public/assets/partials/leafletMap.html",replace:!0,controller:["$scope","$element","$attrs",function(l,r,a){this.showModal=!1,this.markers=[],this.map=L.map("leaflet-map").setView([50.4501,30.5234],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data ï¿½ <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18}).addTo(this.map),this.polyline=null,this.selectedPoint={index:null,lat:null,lng:null,alt:null,marker:null};var i=function(e){var a=r[0].querySelector(".map-modal");a&&!a.contains(e.target)&&(this.closeMapModalHandler(),l.$apply(),t.off("click",i))}.bind(this),n=function(r){var a=function(e){e.originalEvent.stopPropagation();var r=parseInt(e.target._icon.querySelector("div").dataset.index),a=this.markers[r].getLatLng();this.selectedPoint.index=r+1,this.selectedPoint.marker=this.markers[r],this.selectedPoint.lat=a.lat,this.selectedPoint.lng=a.lng,this.selectedPoint.alt=a.alt,this.showModal=!0,l.$apply(),t.on("click",i)}.bind(this),n=function(t){var l=r._latlng.alt,a={lat:t.target._latlng.lat,lng:t.target._latlng.lng};void 0!==l&&(a.alt=l),r.setLatLng(a),this.polyline=e.drawPolyline(this.polyline,this.markers,this.map),this.ngModel=this.markers.map(function(e){return e._latlng})}.bind(this);r.on("dragend",n),r.on("click",a)}.bind(this),s=function(t){var l=t.latlng,r=e.createMarker(this.map,this.markers,l);n(r),this.polyline=e.drawPolyline(this.polyline,this.markers,this.map),this.ngModel=this.markers.map(function(e){return e._latlng})}.bind(this);this.map.on("click",s),this.deleteMarker=function(t){for(var l=-1,r=0;r<this.markers.length;r++)if(this.selectedPoint.marker===this.markers[r]){l=r;break}if(l!==-1){e.removeAllMarkersFromMap(this.map,this.markers),this.markers.splice(l,1),e.renderAllMarkersOnMap(this.map,this.markers);for(var r=0;r<this.markers.length;r++)n(this.markers[r]);this.polyline=e.drawPolyline(this.polyline,this.markers,this.map),this.ngModel=this.markers.map(function(e){return e._latlng})}this.showModal=!1},this.submitEditMarkerHandler=function(){var t=-1,l=parseInt(this.selectedPoint.index)-1,r={lat:parseFloat(this.selectedPoint.lat),lng:parseFloat(this.selectedPoint.lng)};void 0!==this.selectedPoint.alt&&(r.alt=parseFloat(this.selectedPoint.alt)),l>this.markers.length-1&&(l=this.markers.length-1);for(var a=0;a<this.markers.length;a++)if(this.markers[a]===this.selectedPoint.marker){t=a;break}if(t!==l){var i=this.markers.splice(t,1)[0],n=this.markers.splice(l,1,i)[0];this.markers.splice(t,0,n);for(var a=0;a<this.markers.length;a++){var s=this.markers[a]._icon.querySelector("div");s.dataset.index=a,s.innerHTML=a+1}}this.selectedPoint.marker.setLatLng(r),this.polyline=e.drawPolyline(this.polyline,this.markers,this.map),this.ngModel=this.markers.map(function(e){return e._latlng}),this.closeMapModalHandler()},this.closeMapModalHandler=function(){this.showModal=!1,this.selectedPoint={index:null,lat:null,lng:null,alt:null,marker:null},t.off("click",i)},l.$on("destroy",function(){t.off("click",i)})}],controllerAs:"lm",bindToController:!0}}]),angular.module("myApp").controller("leafletMapCtrl",["$scope","$http",function(e,t){this.coordinates=[],this.submitRoute=function(){var e=this.coordinates;console.log(e),t({method:"POST",url:"/saveRouting",headers:{"Content-Type":"application/json"},data:e}).then(function(e){console.log(e)},function(e){console.log(e)})}}]);
//# sourceMappingURL=sourcemaps/app.js.map
