"use strict";var app=angular.module("myApp",[]);angular.module("myApp").service("leafletService",function(){this.removeAllMarkersFromMap=function(t,e){for(var l=0;l<e.length;l++)t.removeLayer(e[l])},this.renderAllMarkersOnMap=function(t,e){var l=e.map(function(t){return t._latlng});e.splice(0,e.length);for(var r=0;r<l.length;r++)this.createMarker(t,e,l[r])},this.renderPolyline=function(t,e,l){var r=e.map(function(t){return t._latlng});return t?t.setLatLngs(r):t=L.polyline(r,{color:"red"}).addTo(l),t},this.createMarker=function(t,e,l){var r=L.divIcon({className:"leaflet-marker",html:'<div data-index="'+e.length+'">'+(e.length+1)+"</div>"}),a=L.marker([l.lat,l.lng],{icon:r,draggable:!0}).addTo(t);return e.push(a),a}}),angular.module("myApp").directive("leafletMap",["leafletService","$document",function(t,e){return{restrict:"EA",require:"^ngModel",scope:{ngModel:"="},templateUrl:"public/assets/partials/leafletMap.html",replace:!0,controller:["$scope","$element","$attrs",function(l,r,a){this.showModal=!1,this.markers=[],this.polyline=null,this.map=L.map("leaflet-map").setView([50.4501,30.5234],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data ï¿½ <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:18}).addTo(this.map),this.selectedPoint={index:null,lat:null,lng:null,alt:null,marker:null};var n=function(t){var a=r[0].querySelector(".map-modal");a&&!a.contains(t.target)&&(this.closeMapModalHandler(),l.$apply(),e.off("click",n))}.bind(this),i=function(r){var a=function(t){t.originalEvent.stopPropagation();var r=parseInt(t.target._icon.querySelector("div").dataset.index),a=this.markers[r].getLatLng();this.selectedPoint.index=r+1,this.selectedPoint.marker=this.markers[r],this.selectedPoint.lat=a.lat,this.selectedPoint.lng=a.lng,this.selectedPoint.alt=a.alt,this.showModal=!0,l.$apply(),e.on("click",n)}.bind(this),i=function(e){var l=r._latlng.alt,a={lat:e.target._latlng.lat,lng:e.target._latlng.lng};void 0!==l&&(a.alt=l),r.setLatLng(a),this.polyline=t.renderPolyline(this.polyline,this.markers,this.map),this.ngModel=this.markers.map(function(t){return t._latlng})}.bind(this);r.on("dragend",i),r.on("click",a)}.bind(this),s=function(e){var l=e.latlng,r=t.createMarker(this.map,this.markers,l);i(r),this.polyline=t.renderPolyline(this.polyline,this.markers,this.map),this.ngModel=this.markers.map(function(t){return t._latlng})}.bind(this);this.map.on("click",s),this.deleteMarker=function(e){for(var l=-1,r=0;r<this.markers.length;r++)if(this.selectedPoint.marker===this.markers[r]){l=r;break}if(l!==-1){t.removeAllMarkersFromMap(this.map,this.markers),this.markers.splice(l,1),t.renderAllMarkersOnMap(this.map,this.markers);for(var r=0;r<this.markers.length;r++)i(this.markers[r]);this.polyline=t.renderPolyline(this.polyline,this.markers,this.map),this.ngModel=this.markers.map(function(t){return t._latlng})}this.showModal=!1},this.submitEditMarkerHandler=function(){var e=-1,l=parseInt(this.selectedPoint.index)-1,r={lat:parseFloat(this.selectedPoint.lat),lng:parseFloat(this.selectedPoint.lng)};void 0!==this.selectedPoint.alt&&(r.alt=parseFloat(this.selectedPoint.alt)),l>this.markers.length-1&&(l=this.markers.length-1);for(var a=0;a<this.markers.length;a++)if(this.markers[a]===this.selectedPoint.marker){e=a;break}if(e!==l){var n=this.markers.splice(e,1)[0],i=this.markers.splice(l,1,n)[0];this.markers.splice(e,0,i);for(var a=0;a<this.markers.length;a++){var s=this.markers[a]._icon.querySelector("div");s.dataset.index=a,s.innerHTML=a+1}}this.selectedPoint.marker.setLatLng(r),this.polyline=t.renderPolyline(this.polyline,this.markers,this.map),this.ngModel=this.markers.map(function(t){return t._latlng}),this.closeMapModalHandler()},this.closeMapModalHandler=function(){this.showModal=!1,this.selectedPoint={index:null,lat:null,lng:null,alt:null,marker:null},e.off("click",n)},l.$on("destroy",function(){e.off("click",n)})}],controllerAs:"lm",bindToController:!0}}]),angular.module("myApp").controller("leafletMapCtrl",["$scope","$http",function(t,e){this.coordinates=[],this.submitRoute=function(){var t=this.coordinates;console.log(t),e({method:"POST",url:"/saveRouting",headers:{"Content-Type":"application/json"},data:t}).then(function(t){console.log(t)},function(t){console.log(t)})}}]);
//# sourceMappingURL=sourcemaps/app.js.map
