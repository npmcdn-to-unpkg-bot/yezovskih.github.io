{"version":3,"sources":["app.js","leafletService.js","leafletMap/leafletMap.js","leafletMapCtrl.js"],"names":["app","angular","module","service","this","removeAllMarkersFromMap","map","markers","i","length","removeLayer","renderAllMarkersOnMap","arr","m","_latlng","splice","createMarker","renderPolyline","polyline","L","color","addTo","latlng","icon","divIcon","className","html","marker","lat","lng","draggable","push","directive","leafletService","$document","restrict","require","scope","ngModel","templateUrl","replace","controller","$scope","$element","$attrs","showModal","setView","tileLayer","attribution","maxZoom","selectedPoint","index","alt","documentClickHandler","e","modal","querySelector","contains","target","closeMapModalHandler","$apply","off","bind","pointClickHandler","clickMarkerHandler","originalEvent","stopPropagation","ind","parseInt","_icon","dataset","pos","getLatLng","on","dragendMarkerHandler","undefined","setLatLng","deleteMarker","submitEditMarkerHandler","newInd","parseFloat","m1","m2","innerHTML","$on","controllerAs","bindToController","$http","coordinates","submitRoute","data","console","log","method","url","headers","Content-Type","then","res"],"mappings":"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","file":"app.js","sourcesContent":["'use strict'\r\n\r\nvar app = angular.module('myApp', []);\r\n\r\n\r\n","'use strict'\r\n\r\nangular.module('myApp').service('leafletService', function() {\r\n\r\n    // map: leaflet map object\r\n    this.removeAllMarkersFromMap = function(map, markers) {\r\n        for(var i = 0; i < markers.length; i++) {\r\n            map.removeLayer(markers[i]);\r\n        }\r\n    }\r\n\r\n    // map: leaflet map object\r\n    // markers: array of leaflet marker objects\r\n    this.renderAllMarkersOnMap = function(map, markers){\r\n        var arr = markers.map(function(m){ return m._latlng});\r\n\r\n        markers.splice(0, markers.length);\r\n\r\n        for(var i = 0; i < arr.length; i++) {\r\n            this.createMarker(map, markers, arr[i]);\r\n        }\r\n    }\r\n\r\n    // returns new polyline\r\n    this.renderPolyline = function(polyline, markers, map){\r\n        if(polyline) map.removeLayer(polyline);\r\n\r\n        var arr = markers.map(function(m){ return m._latlng});\r\n        return L.polyline(arr, {color: 'red'}).addTo(map);\r\n    }\r\n\r\n    // adds marker to map.\r\n    // returns created leaflet marker object.\r\n    this.createMarker = function(map, markers, latlng) {\r\n        var icon = L.divIcon({className: 'leaflet-marker', html:'<div data-index=\"'+ markers.length +'\">'+ (markers.length + 1) +'</div>'});\r\n        var marker = L.marker([latlng.lat, latlng.lng],{icon: icon, draggable: true}).addTo(map);\r\n        markers.push(marker);\r\n        return marker;\r\n    }\r\n\r\n});\r\n\r\n","'use strict'\r\n\r\nangular.module('myApp').directive('leafletMap', ['leafletService', '$document', function(leafletService, $document) {\r\n    return {\r\n        restrict: \"EA\",\r\n        require: '^ngModel',\r\n        scope: {\r\n            ngModel: \"=\"\r\n        },\r\n        templateUrl: 'public/assets/partials/leafletMap.html',\r\n        replace: true,\r\n        controller: ['$scope', '$element', '$attrs', function($scope, $element, $attrs) {\r\n            this.showModal = false;\r\n\r\n            this.markers = [];\r\n            this.polyline = null;\r\n            this.map = L.map('leaflet-map').setView([50.4501, 30.5234], 13);\r\n\r\n            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n                attribution: 'Map data ï¿½ <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors',\r\n                maxZoom: 18\r\n            }).addTo(this.map);\r\n\r\n            this.selectedPoint = {index: null, lat: null, lng: null, alt: null, marker: null};\r\n\r\n            var documentClickHandler = (function(e) {\r\n                var modal = $element[0].querySelector('.map-modal');\r\n                if (modal && !modal.contains(e.target)) {\r\n                    this.closeMapModalHandler();\r\n                    $scope.$apply();\r\n                    $document.off('click', documentClickHandler);\r\n                }\r\n            }).bind(this);\r\n\r\n            var pointClickHandler = (function (e) {\r\n                var latlng = e.latlng,\r\n                    marker = leafletService.createMarker(this.map, this.markers, latlng);\r\n\r\n                var clickMarkerHandler = (function(e){\r\n                    e.originalEvent.stopPropagation();\r\n\r\n                    var ind = parseInt(e.target._icon.querySelector('div').dataset.index);\r\n                    var pos = this.markers[ind].getLatLng();\r\n\r\n                    this.selectedPoint.index = ind + 1;\r\n                    this.selectedPoint.marker = this.markers[ind];\r\n                    this.selectedPoint.lat = pos.lat;\r\n                    this.selectedPoint.lng = pos.lng;\r\n                    this.selectedPoint.alt = pos.alt;\r\n\r\n                    this.showModal = true;\r\n\r\n                    $scope.$apply();\r\n                    $document.on('click', documentClickHandler);\r\n                }).bind(this);\r\n\r\n                var dragendMarkerHandler = (function(e) {\r\n                    var alt = marker._latlng.alt;\r\n                    var pos = {lat: e.target._latlng.lat, lng: e.target._latlng.lng};\r\n                    if(alt !== undefined) pos.alt = alt;\r\n\r\n                    marker.setLatLng(pos);\r\n\r\n                    this.polyline = leafletService.renderPolyline(this.polyline, this.markers, this.map);\r\n                    this.ngModel = this.markers.map(function(m){ return m._latlng});\r\n                }).bind(this);\r\n\r\n                marker.on('dragend', dragendMarkerHandler);\r\n                marker.on('click', clickMarkerHandler);\r\n\r\n                this.polyline = leafletService.renderPolyline(this.polyline, this.markers, this.map);\r\n\r\n                this.ngModel = this.markers.map(function(m){ return m._latlng});\r\n            }).bind(this);\r\n\r\n            this.map.on('click', pointClickHandler);\r\n\r\n            this.deleteMarker = function(e) {\r\n                var ind = -1;\r\n\r\n                for(var i = 0; i < this.markers.length; i++){\r\n                    if(this.selectedPoint.marker === this.markers[i]) {\r\n                        ind = i;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                // remove from array and render polyline\r\n                if(ind !== -1) {\r\n                    leafletService.removeAllMarkersFromMap(this.map, this.markers);\r\n                    this.markers.splice(ind, 1);\r\n                    leafletService.renderAllMarkersOnMap(this.map, this.markers);\r\n                    this.polyline = leafletService.renderPolyline(this.polyline, this.markers, this.map);\r\n\r\n                    this.ngModel = this.markers.map(function(m){ return m._latlng});\r\n                }\r\n\r\n                this.showModal = false;\r\n            }\r\n\r\n            this.submitEditMarkerHandler = function() {\r\n                var ind = -1;\r\n                var newInd = parseInt(this.selectedPoint.index) - 1;\r\n                var latlng = {\r\n                    lat: parseFloat(this.selectedPoint.lat),\r\n                    lng: parseFloat(this.selectedPoint.lng)\r\n                };\r\n                if(this.selectedPoint.alt !== undefined) latlng.alt = parseFloat(this.selectedPoint.alt);\r\n\r\n                if(newInd > this.markers.length - 1) newInd = this.markers.length - 1;\r\n\r\n                for(var i = 0; i < this.markers.length; i++){\r\n                    if(this.markers[i] === this.selectedPoint.marker){\r\n                        ind = i;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if(ind !== newInd){\r\n                    var m1 = this.markers.splice(ind, 1)[0];\r\n                    var m2 = this.markers.splice(newInd, 1, m1)[0];\r\n                    this.markers.splice(ind, 0, m2);\r\n\r\n                    for(var i = 0; i < this.markers.length; i++){\r\n                        var html = this.markers[i]._icon.querySelector('div');\r\n                        html.dataset.index = i;\r\n                        html.innerHTML = i+1;\r\n                    }\r\n                }\r\n\r\n                this.selectedPoint.marker.setLatLng(latlng);\r\n\r\n                this.polyline = leafletService.renderPolyline(this.polyline, this.markers, this.map);\r\n\r\n                this.ngModel = this.markers.map(function(m){ return m._latlng});\r\n\r\n                this.closeMapModalHandler();\r\n            }\r\n\r\n            this.closeMapModalHandler = function() {\r\n                this.showModal = false;\r\n                this.selectedPoint = {index: null, lat: null, lng: null, alt: null, marker: null};\r\n                $document.off('click', documentClickHandler);\r\n            }\r\n\r\n            $scope.$on('destroy', function(){\r\n                $document.off('click', documentClickHandler);\r\n            });\r\n        }],\r\n        controllerAs: 'lm',\r\n        bindToController: true\r\n    }\r\n}])\r\n","angular.module('myApp').controller('leafletMapCtrl', ['$scope', '$http', function($scope, $http) {\r\n    this.coordinates = [];\r\n\r\n    this.submitRoute = function() {\r\n        var data = this.coordinates;\r\n        console.log(data)\r\n        $http({\r\n            method: 'POST',\r\n            url: '/saveRouting',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n            data: data\r\n        }).then(\r\n            function success(res) {console.log(res)},\r\n            function error(res){console.log(res)}\r\n        )\r\n    }\r\n\r\n}])\r\n"],"sourceRoot":"/source/"}