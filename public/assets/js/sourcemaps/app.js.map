{"version":3,"sources":["app.js","leafletService.js","leafletMap/leafletMap.js","leafletMapCtrl.js"],"names":["app","angular","module","service","this","removeAllMarkersFromMap","map","markers","i","length","removeLayer","renderAllMarkersOnMap","arr","m","_latlng","splice","createMarker","drawPolyline","polyline","removePolyline","L","layerGroup","p","color","addTo","d","polylineDecorator","patterns","offset","repeat","symbol","Symbol","arrowHead","pixelSize","pathOptions","addLayer","eachLayer","layer","latlng","icon","divIcon","className","html","marker","lat","lng","draggable","push","directive","leafletService","$document","restrict","require","scope","ngModel","templateUrl","replace","controller","$scope","$element","$attrs","showModal","setView","tileLayer","attribution","maxZoom","selectedPoint","index","alt","documentClickHandler","e","modal","querySelector","contains","target","closeMapModalHandler","$apply","off","bind","addEventListenersToMarker","clickMarkerHandler","originalEvent","stopPropagation","ind","parseInt","_icon","dataset","pos","getLatLng","on","dragendMarkerHandler","undefined","setLatLng","pointClickHandler","deleteMarker","submitEditMarkerHandler","newInd","parseFloat","m1","m2","innerHTML","$on","controllerAs","bindToController","$http","coordinates","submitRoute","data","console","log","method","url","headers","Content-Type","then","res"],"mappings":"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","file":"app.js","sourcesContent":["'use strict'\r\n\r\nvar app = angular.module('myApp', []);\r\n\r\n\r\n","'use strict'\r\n\r\nangular.module('myApp').service('leafletService', function() {\r\n\r\n    // map: leaflet map object\r\n    this.removeAllMarkersFromMap = function(map, markers) {\r\n        for(var i = 0; i < markers.length; i++) {\r\n            map.removeLayer(markers[i]);\r\n        }\r\n    }\r\n\r\n    // map: leaflet map object\r\n    // markers: array of leaflet marker objects\r\n    this.renderAllMarkersOnMap = function(map, markers){\r\n        var arr = markers.map(function(m){ return m._latlng});\r\n\r\n        markers.splice(0, markers.length);\r\n\r\n        for(var i = 0; i < arr.length; i++) {\r\n            this.createMarker(map, markers, arr[i]);\r\n        }\r\n    }\r\n\r\n    // returns layerGroup with polylines and polyline decorators.\r\n    this.drawPolyline = function(polyline, markers, map){\r\n        var arr = markers.map(function(m){ return m._latlng}),\r\n            polyline = this.removePolyline(polyline, map);\r\n\r\n        if(arr.length > 1) {\r\n            polyline = L.layerGroup();\r\n            for (var i = 0; i < arr.length; i++) {\r\n                if (i + 1 < arr.length) {\r\n                    var p = L.polyline([arr[i], arr[i + 1]], {color: 'red'}).addTo(map);\r\n                    var d = L.polylineDecorator(p, {\r\n                        patterns: [\r\n                            {\r\n                                offset: '100%',\r\n                                repeat: 0,\r\n                                symbol: new L.Symbol.arrowHead({pixelSize: 10, pathOptions: {color: 'red'}})\r\n                            }\r\n                        ]\r\n                    }).addTo(map);\r\n                    polyline.addLayer(p);\r\n                    polyline.addLayer(d);\r\n                }\r\n            }\r\n        }\r\n\r\n        return polyline;\r\n    }\r\n\r\n    // removes all layers from polyline(LayerGroup).\r\n    this.removePolyline = function(polyline, map) {\r\n        if(polyline) polyline.eachLayer(function(layer){\r\n            map.removeLayer(layer);\r\n        });\r\n        return null;\r\n    }\r\n\r\n    // adds marker to map.\r\n    // returns created leaflet marker object.\r\n    this.createMarker = function(map, markers, latlng) {\r\n        var icon = L.divIcon({className: 'leaflet-marker', html:'<div data-index=\"'+ markers.length +'\">'+ (markers.length + 1) +'</div>'});\r\n        var marker = L.marker([latlng.lat, latlng.lng],{icon: icon, draggable: true}).addTo(map);\r\n        markers.push(marker);\r\n        return marker;\r\n    }\r\n\r\n});\r\n\r\n","'use strict'\r\n\r\nangular.module('myApp').directive('leafletMap', ['leafletService', '$document', function(leafletService, $document) {\r\n    return {\r\n        restrict: \"EA\",\r\n        require: '^ngModel',\r\n        scope: {\r\n            ngModel: \"=\"\r\n        },\r\n        templateUrl: 'public/assets/partials/leafletMap.html',\r\n        replace: true,\r\n        controller: ['$scope', '$element', '$attrs', function($scope, $element, $attrs) {\r\n            this.showModal = false;\r\n\r\n            this.markers = [];\r\n            this.map = L.map('leaflet-map').setView([50.4501, 30.5234], 13);\r\n\r\n            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n                attribution: 'Map data ï¿½ <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors',\r\n                maxZoom: 18\r\n            }).addTo(this.map);\r\n\r\n            this.polyline = null;\r\n\r\n            function removePolyline(){\r\n\r\n            }\r\n\r\n            this.selectedPoint = {index: null, lat: null, lng: null, alt: null, marker: null};\r\n\r\n            var documentClickHandler = (function(e) {\r\n                var modal = $element[0].querySelector('.map-modal');\r\n                if (modal && !modal.contains(e.target)) {\r\n                    this.closeMapModalHandler();\r\n                    $scope.$apply();\r\n                    $document.off('click', documentClickHandler);\r\n                }\r\n            }).bind(this);\r\n\r\n            var addEventListenersToMarker = (function(marker) {\r\n\r\n                var clickMarkerHandler = (function(e){\r\n                    e.originalEvent.stopPropagation();\r\n\r\n                    var ind = parseInt(e.target._icon.querySelector('div').dataset.index);\r\n                    var pos = this.markers[ind].getLatLng();\r\n\r\n                    this.selectedPoint.index = ind + 1;\r\n                    this.selectedPoint.marker = this.markers[ind];\r\n                    this.selectedPoint.lat = pos.lat;\r\n                    this.selectedPoint.lng = pos.lng;\r\n                    this.selectedPoint.alt = pos.alt;\r\n\r\n                    this.showModal = true;\r\n\r\n                    $scope.$apply();\r\n                    $document.on('click', documentClickHandler);\r\n                }).bind(this);\r\n\r\n                var dragendMarkerHandler = (function(e) {\r\n                    var alt = marker._latlng.alt;\r\n                    var pos = {lat: e.target._latlng.lat, lng: e.target._latlng.lng};\r\n                    if(alt !== undefined) pos.alt = alt;\r\n\r\n                    marker.setLatLng(pos);\r\n\r\n                    this.polyline = leafletService.drawPolyline(this.polyline, this.markers, this.map);\r\n\r\n                    this.ngModel = this.markers.map(function(m){ return m._latlng});\r\n                }).bind(this);\r\n\r\n                marker.on('dragend', dragendMarkerHandler);\r\n                marker.on('click', clickMarkerHandler);\r\n\r\n            }).bind(this);\r\n\r\n            var pointClickHandler = (function (e) {\r\n                var latlng = e.latlng,\r\n                    marker = leafletService.createMarker(this.map, this.markers, latlng);\r\n\r\n                addEventListenersToMarker(marker);\r\n\r\n                this.polyline = leafletService.drawPolyline(this.polyline, this.markers, this.map);\r\n\r\n                this.ngModel = this.markers.map(function(m){ return m._latlng});\r\n            }).bind(this);\r\n\r\n            this.map.on('click', pointClickHandler);\r\n\r\n            this.deleteMarker = function(e) {\r\n                var ind = -1;\r\n\r\n                for(var i = 0; i < this.markers.length; i++){\r\n                    if(this.selectedPoint.marker === this.markers[i]) {\r\n                        ind = i;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                // remove from array and render polyline\r\n                if(ind !== -1) {\r\n                    leafletService.removeAllMarkersFromMap(this.map, this.markers);\r\n                    this.markers.splice(ind, 1);\r\n                    leafletService.renderAllMarkersOnMap(this.map, this.markers);\r\n\r\n                    for(var i = 0; i < this.markers.length; i++) {\r\n                        addEventListenersToMarker(this.markers[i]);\r\n                    }\r\n                    this.polyline = leafletService.drawPolyline(this.polyline, this.markers, this.map);\r\n\r\n                    this.ngModel = this.markers.map(function(m){ return m._latlng});\r\n                }\r\n\r\n                this.showModal = false;\r\n            }\r\n\r\n            this.submitEditMarkerHandler = function() {\r\n                var ind = -1;\r\n                var newInd = parseInt(this.selectedPoint.index) - 1;\r\n                var latlng = {\r\n                    lat: parseFloat(this.selectedPoint.lat),\r\n                    lng: parseFloat(this.selectedPoint.lng)\r\n                };\r\n                if(this.selectedPoint.alt !== undefined) latlng.alt = parseFloat(this.selectedPoint.alt);\r\n\r\n                if(newInd > this.markers.length - 1) newInd = this.markers.length - 1;\r\n\r\n                for(var i = 0; i < this.markers.length; i++){\r\n                    if(this.markers[i] === this.selectedPoint.marker){\r\n                        ind = i;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if(ind !== newInd){\r\n                    var m1 = this.markers.splice(ind, 1)[0];\r\n                    var m2 = this.markers.splice(newInd, 1, m1)[0];\r\n                    this.markers.splice(ind, 0, m2);\r\n\r\n                    for(var i = 0; i < this.markers.length; i++){\r\n                        var html = this.markers[i]._icon.querySelector('div');\r\n                        html.dataset.index = i;\r\n                        html.innerHTML = i+1;\r\n                    }\r\n                }\r\n\r\n                this.selectedPoint.marker.setLatLng(latlng);\r\n\r\n                this.polyline = leafletService.drawPolyline(this.polyline, this.markers, this.map);\r\n\r\n                this.ngModel = this.markers.map(function(m){ return m._latlng});\r\n\r\n                this.closeMapModalHandler();\r\n            }\r\n\r\n            this.closeMapModalHandler = function() {\r\n                this.showModal = false;\r\n                this.selectedPoint = {index: null, lat: null, lng: null, alt: null, marker: null};\r\n                $document.off('click', documentClickHandler);\r\n            }\r\n\r\n            $scope.$on('destroy', function(){\r\n                $document.off('click', documentClickHandler);\r\n            });\r\n        }],\r\n        controllerAs: 'lm',\r\n        bindToController: true\r\n    }\r\n}])\r\n","angular.module('myApp').controller('leafletMapCtrl', ['$scope', '$http', function($scope, $http) {\r\n    this.coordinates = [];\r\n\r\n    this.submitRoute = function() {\r\n        var data = this.coordinates;\r\n        console.log(data)\r\n        $http({\r\n            method: 'POST',\r\n            url: '/saveRouting',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n            data: data\r\n        }).then(\r\n            function success(res) {console.log(res)},\r\n            function error(res){console.log(res)}\r\n        )\r\n    }\r\n\r\n}])\r\n"],"sourceRoot":"/source/"}